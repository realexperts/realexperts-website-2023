---
import { fetchFooterMenu, fetchSettings } from '@/lib/directus';
import { Image } from 'astro:assets';
import { marked } from 'marked';
import Container from '../components/Container.astro';
import FooterMenu from '../components/FooterMenu.astro';
import Heading from '../components/Heading.astro';
import Section from '../components/Section.astro';

const menu = await fetchFooterMenu();
const settings = await fetchSettings();

const logoFooterSrc = `${import.meta.env.DIRECTUS_URL}/assets/${
  settings.logo_footer?.id
}?access_token=${import.meta.env.DIRECTUS_TOKEN}`;

const isSvg = settings.logo_footer?.filename_disk?.endsWith('.svg');
---

<footer>
  <Section
    color='#0F3F93'
    section_styles={['full_width']}
    marginBottom={'mb-0'}
  >
    <Container centered={false}>
      <div class='justify-between lg:flex'>
        <div>
          <div class='mb-12 h-[177px]'>
            <Image
              src={logoFooterSrc}
              alt='Logo Real Experts   Network GmbH'
              width='134'
              height='177'
              densities={[1, 2, 3]}
              format={isSvg ? 'svg' : 'webp'}
              loading={'lazy'}
            />
          </div>
          <div
            class='-mt-1 leading-8'
            set:html={marked(settings?.footer_address || '')}
          />
        </div>
        <div>
          {
            settings.footer_headline && (
              <div class='mb-12 flex h-[177px] items-center'>
                <Heading>{settings.footer_headline}</Heading>
              </div>
            )
          }
          <div class='justify-between lg:flex'>
            {
              menu.translations
                ?.find((item) => item.languages_code === 'de-DE')
                ?.nodes?.map((item) => {
                  return (
                    <FooterMenu
                      menu={{
                        headline: item.title || '',
                        items:
                          item.nodes?.map((child) => {
                            return {
                              title: child.title || '',
                              link: (() => {
                                if (
                                  child.type === 'intern' &&
                                  child.linked_page?.url
                                ) {
                                  return (
                                    child.linked_page?.url +
                                    `${
                                      child.anchor?.slug
                                        ? '#' + child.anchor?.slug
                                        : ''
                                    }`
                                  );
                                }

                                if (child.type === 'extern' && child?.url) {
                                  return child?.url;
                                }

                                return '#';
                              })()
                            };
                          }) || []
                      }}
                    />
                  );
                })
            }
          </div>
        </div>
      </div>
    </Container>
  </Section>
</footer>
<button
  onclick="window.scrollTo({ top: 0, behavior: 'smooth' });"
  type='button'
  class='site-scroll-top-button group fixed bottom-6 right-6 z-50 h-12 w-12 overflow-hidden rounded-full border-2 border-white bg-re-blue text-white'
  title='Nach oben scrollen'
>
  <div class='transition-all duration-200 group-hover:-mt-12'>
    <i class='fa-solid fa-long-arrow-up mb-5 mt-4 block'></i>
    <i class='fa-solid fa-long-arrow-up -mt-1 block'></i>
  </div>
</button>
