---
import { getMaxWidthClass } from '@/lib/utilities';
import { Image } from 'astro:assets';

type Properties = {
  maxWidthContainer?: string | null;
  testimonials: {
    image: {
      src: string | undefined;
      width?: number | null | undefined;
      height?: number | null | undefined;
    };
    text?: string | null;
    name?: string | null;
    company?: string | null;
  }[];
};

let { maxWidthContainer, testimonials } = Astro.props as Properties;
---

<div
  class:list={[
    '-mx-6 my-14 flex items-center justify-center lg:mx-auto',
    getMaxWidthClass(maxWidthContainer)
  ]}
>
  <div
    class='swiper-button-prev cursor-pointer p-1 text-4xl text-re-turquoise transition-colors duration-200 ease-in-out hover:text-re-blue'
  >
    <i class='fa-solid fa-chevron-left'></i>
  </div>
  <div class='swiper testimonials-slider'>
    <div class='swiper-wrapper'>
      {
        testimonials.map((testimonal, index) => () => (
          <div class='swiper-slide overflow-hidden'>
            <div class='items-center justify-between lg:flex'>
              <div class='mb-8 flex items-center justify-center overflow-hidden lg:mb-0 lg:min-w-[425px]'>
                {testimonal.image.src && (
                  <div class='flex size-[290px] items-center justify-center overflow-hidden rounded-full'>
                    <Image
                      src={testimonal.image.src}
                      alt={`Person ${index + 1}`}
                      height={290}
                      width={290}
                      class={'object-contain'}
                    />
                  </div>
                )}
              </div>
              <div class='w-full lg:pr-8 lg:text-left'>
                <p>“{testimonal.text}“</p>
                <p class='mt-6 text-xl'>
                  <span class='mr-2 font-bold'>{testimonal.name}</span>
                  {testimonal.company}
                </p>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
  <div
    class='swiper-button-next cursor-pointer p-1 text-4xl text-re-turquoise transition-colors duration-200 ease-in-out hover:text-re-blue'
  >
    <i class='fa-solid fa-chevron-right'></i>
  </div>
</div>

<script>
  import Swiper from 'swiper';
  import { Navigation } from 'swiper/modules';
  import 'swiper/css';

  for (const element of document.querySelectorAll('.testimonials-slider')) {
    const swiper = new Swiper(element as HTMLElement, {
      slidesPerView: 1,
      loop: true,
      modules: [Navigation],

      navigation: {
        nextEl: element.parentElement?.querySelector(
          '.swiper-button-next'
        ) as HTMLElement,
        prevEl: element.parentElement?.querySelector(
          '.swiper-button-prev'
        ) as HTMLElement
      }
    });

    swiper.on('slideChange', () => {
      console.log('slideChange');
    });
  }
</script>
