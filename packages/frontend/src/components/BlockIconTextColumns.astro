---
import {
  getAlignmentClass,
  getMaxWidthClass,
  getTextColorClass
} from '@/lib/utilities';
import { Image } from 'astro:assets';
import { marked } from 'marked';
import BlockText from './BlockText.astro';

type Column = {
  alignment?: 'left' | 'center' | 'right';
  color?: 'blue' | 'turquoise' | 'white';
  columnWidthPercent: 33 | 47 | 50;
  imageUrl?: string | undefined | null;
  imageAlt?: string | undefined | null;
  imageWidth?: string | undefined | null;
  imageHeight?: string | undefined | null;
  imageObjectFit?: 'contain' | 'cover' | 'fill' | 'none' | 'scale-down';
  imageOptimize?: boolean;
  text?: string | undefined | null;
};

type Properties = {
  columns: Column[];
  max_width_container?: string;
};

const { columns = [], max_width_container } = Astro.props as Properties;
---

<div
  class:list={[
    'prose mx-auto my-8 max-w-none flex-wrap justify-center lg:flex',
    getMaxWidthClass(max_width_container)
  ]}
>
  {
    columns.map((column) => (
      <div
        class:list={[
          'block-icon-text',
          'lg:px-12',
          'pb-12',
          getAlignmentClass(column.alignment)
        ]}
        style={`width: ${column.columnWidthPercent}%;`}
      >
        <article
          class:list={[
            'prose my-8 max-w-none prose-p:font-light prose-a:text-inherit prose-strong:text-inherit',
            getTextColorClass(column.color)
          ]}
        >
          {column.imageUrl && (
            <Image
              src={column.imageUrl}
              alt={column.imageAlt || ''}
              class='mb-0 inline-block'
              style={`width: ${column.imageWidth || '100%'}; height: ${
                column.imageHeight || '100%'
              }; bject-fit: ${column.imageObjectFit || 'contain'};`}
              width={200}
              height={200}
              loading={'lazy'}
              densities={[1, 2, 3]}
            />
          )}
          <BlockText
            text={marked(column.text ?? '')}
            alignment={column.alignment}
          />
        </article>
      </div>
    ))
  }
</div>

<style>
  @media screen and (max-width: 1024px) {
    .block-icon-text {
      width: 100% !important;
    }
  }
</style>
