---
import {
  getMarginBottomClass,
  getMarginTopClass,
  getPaddingBottomClass,
  getPaddingTopClass
} from '@/lib/utilities';
import { Debug } from 'astro:components';
import { twMerge } from 'tailwind-merge';
import SectionEdit from './react/SectionEdit';

type Properties = {
  id?: number;
  marginTop?: Parameters<typeof getMarginTopClass>[0];
  marginBottom?: Parameters<typeof getMarginBottomClass>[0];
  paddingTop?: Parameters<typeof getPaddingTopClass>[0];
  paddingBottom?: Parameters<typeof getPaddingBottomClass>[0];
  section_styles?: string[] | null;
  bgColorClass?: 'bg-primary' | 'bg-secondary' | 'bg-secondary-light';
  slug?: string | null;
};

Astro.props satisfies Properties;

const {
  id,
  marginTop = 'mt-16',
  marginBottom = 'mb-16',
  paddingTop = 'pt-16',
  paddingBottom = 'pb-16',
  section_styles,
  bgColorClass = 'bg-white',
  slug
} = Astro.props;

// Define a type for the keys of stylesMapping
type StyleKey =
  | 'full_width'
  | 'rounded_tl'
  | 'rounded_tr'
  | 'rounded_bl'
  | 'rounded_br';

const stylesMapping: Record<StyleKey, string> = {
  full_width: 'w-full',
  rounded_tl: 'rounded-tl-3xl',
  rounded_tr: 'rounded-tr-3xl',
  rounded_bl: 'rounded-bl-3xl',
  rounded_br: 'rounded-br-3xl'
};

type BgColorClass = 'bg-primary' | 'bg-secondary' | 'bg-secondary-light';

const bgColorMapping: Record<BgColorClass, string> = {
  'bg-primary': 'bg-primary text-white',
  'bg-secondary': 'bg-secondary text-white',
  'bg-secondary-light': 'bg-secondary-light text-primary'
};

const sectionStyles = section_styles
  ?.map((style: string) => {
    if (style in stylesMapping) {
      return stylesMapping[style as StyleKey];
    }
    return style;
  })
  .join(' ');

const sectionWidth =
  !section_styles?.includes('full_width') &&
  'w-full max-w-website mx-auto scroll-mt-[99px]';

const classes = twMerge(
  bgColorMapping[bgColorClass as BgColorClass],
  sectionWidth,
  sectionStyles,
  getMarginTopClass(marginTop),
  getMarginBottomClass(marginBottom),
  getPaddingTopClass(paddingTop),
  getPaddingBottomClass(paddingBottom)
);
---

<>
  {
    import.meta.env.BUILD_MODE === 'production' ? (
      <section class={classes} id={slug}>
        <slot />
      </section>
    ) : (
      <SectionEdit
        id={id}
        marginTop={marginTop}
        marginBottom={marginBottom}
        paddingTop={paddingTop}
        paddingBottom={paddingBottom}
        client:load
      >
       <Debug {bgColorClass} />
        <section class={classes} id={slug}>
          <slot />
        </section>
      </SectionEdit>
    )
  }
</>
