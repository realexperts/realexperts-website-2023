---
import { fetchMainMenu } from '@/lib/directus';

const { pathname } = new URL(Astro.request.url);

const mainMenu = await fetchMainMenu();
---

<nav id='navbar' class='mb-1'>
  <div id='hamburger'>
    <div></div>
    <div></div>
    <div></div>
  </div>
  <ul
    id='main-menu'
    class='items-centerfont-medium absolute left-0 top-0 mt-[85px] w-full lg:relative lg:mt-0 lg:flex'
  >
    {
      mainMenu?.translations
        ?.find((t) => t.languages_code === 'de-DE')
        ?.nodes?.map((menuItem) => {
          const href = (() => {
            if (menuItem.type === 'intern' && menuItem.linked_page?.url) {
              return (
                menuItem.linked_page?.url +
                `${menuItem.anchor?.slug ? '#' + menuItem.anchor?.slug : ''}`
              );
            }
            if (menuItem.type === 'extern' && menuItem?.url) {
              return menuItem?.url;
            }
            return '#';
          })();

          return (
            <li
              class:list={[
                'ml-11 text-right hover:text-re-turquoise',
                { 'text-re-turquoise': pathname === href },
                { 'text-re-blue': pathname !== href }
              ]}
            >
              <a href={href} set:text={menuItem?.title} />
            </li>
          );
        })
    }
    <li class='ml-9 text-right'>
      <a
        href='https://www.linkedin.com/in/crauhut/'
        target='_blank'
        title='LinkedIn Profil'
      >
        <i class='fa-brands fa-linkedin text-2xl text-re-blue'></i>
      </a>
    </li>
    <li class='ml-6 text-right'>
      <a
        href='https://calendly.com/rauhut/erstgesprach-mit-christoph-rauhut'
        target='_blank'
        title='Termin vereinbaren'
      >
        <i class='fa-solid fa-calendar-check text-2xl text-re-blue'></i>
      </a>
    </li>
    <li class='ml-6 text-right'>
      <a href='/#kontakt' title='Kontakt aufnehmen'>
        <i class='fa-solid fa-envelope text-2xl text-re-blue'></i>
      </a>
    </li>
  </ul>
</nav>

<style>
  #hamburger {
    @apply flex h-6 w-10 flex-col justify-between lg:hidden;
  }
  #hamburger div {
    @apply h-[3px] bg-black transition-all duration-200 ease-in-out;
  }
  #navbar.main-menu-open #hamburger div:nth-child(1) {
    @apply origin-center translate-y-[0.95rem] rotate-45 bg-transparent;
  }
  #navbar.main-menu-open #hamburger div:nth-child(2) {
    @apply origin-center rotate-45;
  }
  #navbar.main-menu-open #hamburger div:nth-child(3) {
    @apply origin-center -translate-y-[0.65rem] -rotate-45;
  }

  #main-menu {
    @apply px-8 opacity-0 lg:px-0 lg:opacity-100;
  }
  #main-menu li {
    @apply text-[0px] transition-all duration-200 ease-in-out lg:text-base;
  }
  #navbar.main-menu-open #main-menu {
    @apply block max-h-fit bg-white/[95%] pt-0 opacity-100 shadow;
  }
  #navbar.main-menu-open #main-menu li {
    @apply my-4 text-base;
  }
</style>
<script>
  document.querySelector('#hamburger')?.addEventListener('click', () => {
    document.querySelector('#navbar')?.classList.toggle('main-menu-open');
  });
  window.addEventListener('resize', () => {
    document.querySelector('#navbar')?.classList.remove('main-menu-open');
  });
</script>
