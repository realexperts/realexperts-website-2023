---
import type { BlockLogoSlider } from '@/lib/schema';
import { getImage } from 'astro:assets';

export interface Props extends BlockLogoSlider {}

const { slides } = Astro.props;

// Loop all slides and get the image for each slide
const getOptimizedSlide = async (slide: BlockLogoSlider['slides'][0]) => {
  const src = `${import.meta.env.DIRECTUS_URL}/assets/${slide.image.id}`;
  const optimizedImage = await getImage({
    src,
    format: 'jpg',
    width: slide.image.width,
    height: slide.image.height,
    quality: 80
  });
  return {
    ...slide,
    image: optimizedImage
  };
};

const getSlidesWithImages = async (slides: BlockLogoSlider['slides']) => {
  return Promise.all(slides.map((slide) => getOptimizedSlide(slide)));
};

const slidesWithImages = await getSlidesWithImages(slides);
---

<div class='flex items-center justify-center'>
  <div
    class='swiper-button-prev
      cursor-pointer
      p-1
      text-3xl
      text-zinc-300
      transition-colors
      duration-200
      ease-in-out
      hover:text-re-blue'
  >
    <i class='fa-solid fa-chevron-left'></i>
  </div>
  <div class='swiper logo-slider'>
    <div class='swiper-wrapper'>
      {
        slidesWithImages.map((slide) => (
          <div class='swiper-slide w-1/4 overflow-hidden'>
            <div class='flex items-center justify-center'>
              <img
                src={slide.image.src}
                alt={slide.title}
                class='h-[70px] w-[185px] object-contain'
              />
            </div>
          </div>
        ))
      }
    </div>
  </div>
  <div
    class='swiper-button-next
      cursor-pointer
      p-1
      text-3xl
      text-zinc-300
      transition-colors
      duration-200
      ease-in-out
      hover:text-re-blue'
  >
    <i class='fa-solid fa-chevron-right'></i>
  </div>
</div>

<script>
  import Swiper from 'swiper';
  import { Navigation } from 'swiper/modules';
  import 'swiper/css';

  for (const [index, element] of document
    .querySelectorAll('.logo-slider')
    .entries()) {
    new Swiper(element, {
      slidesPerView: 4,
      loop: true,
      modules: [Navigation],

      navigation: {
        nextEl: element.parentElement.querySelector('.swiper-button-next'),
        prevEl: element.parentElement.querySelector('.swiper-button-prev')
      }
    });
  }
</script>
